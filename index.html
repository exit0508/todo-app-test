<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <title>Todo リスト</title>
</head>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<body>
    <div id='app'>
        <div class="container">
            <h2>TODO リスト</h2>
            <div class=row>
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <form class="add-form" v-on:submit.prevent="addTodo()">
                                <div class="row">
                                    <div class="col-4 text-center">
                                        <input type="text" class="todo-input" placeholder="タスク入力" v-model='newTodo'>
                                    </div>
                                    <div class="col">
                                        <div class="label">
                                            興味：
                                        </div>
                                        <div class="level">
                                            {{ interest }}
                                        </div>
                                        <input type="range" min="0" max="5" step="1" v-model="interest">
                                    </div>
                                    <div class="col">
                                        <div class="label">
                                            楽しさ：
                                        </div>
                                        <div class="level">
                                            {{ pleasant }}
                                        </div>
                                        <input type="range" min="0" max="5" step="1" v-model="pleasant">
                                    </div>
                                    <div class="col">
                                        <div class="label">
                                            複雑度：
                                        </div>
                                        <div class="level">
                                            {{ complexity }}
                                        </div>
                                        <input type="range" min="0" max="5" step="1" v-model="complexity">
                                    </div>
                                    <div class="col">
                                        <div class="label">
                                            重要度：
                                        </div>
                                        <div class="level">
                                            {{ importance }}
                                        </div>
                                        <input type="range" min="0" max="5" step="1" v-model="importance">
                                    </div>
                                    <div class="col submit-button">
                                        <button type="submit"><img src="img\add-24px.svg" alt="追加" /></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <h2>登録済み</h2>
            <div class="todo-list">
                    <div v-for="(todo, index) in todos">
                    {{ todo.id }} - {{ todo.title }} - {{ todo.interest }} - {{ todo.pleasant }} - {{ todo.complexity }} - {{ todo.importance }}
                        <button v-on:click="removeTodo(index)">&times;</button>
                        <div v-if="todo.complexity > 2">
                            <button v-on:click="getIndex(index)" class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseMicro" aria-expanded="false" aria-controls="collapseExample">
                                細分化する
                            </button>
                            <div class="collapse" id="collapseMicro">
                                <div class="card card-body">
                                    <div v-for="(subtodo, index) in showMicrotasks">
                                    {{ subtodo.id }} - {{ subtodo.title }}
                                    </div>
                                    <emit-event v-on:from-child="receiveMessage"></emit-event>
                                    <span>
                                        <button type="submit"><img src="img\done-24px.svg" alt="追加" /></button>
                                        <button type="submit"><img src="img\create-24px.svg" alt="編集" /></button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
    <!-- <pre>{{ $data }}</pre> -->
    </div>
    <script>

        Vue.component('emit-event',{
            template: `<div><input type="text" v-model="inputText" placeholder="タスク細分化"><button v-on:click="clickEvent">+</button></div>`,
            data: function(){
                return {
                    inputText: ''
                }
            },
            methods: {
                clickEvent: function(){
                    this.$emit('from-child', this.inputText)
                    this.inputText = ''
                }
            }
        })

        new Vue({
            el: '#app',
            data: {
                subtodos: [],
                subid: '',
                newTodo: '',
                idForTodo: '2',
                interest: '0',
                pleasant: '0',
                complexity: '0',
                importance: '0',
                beforeEditCache: '',
                completed: false,
                message: '',
                todos:[
                    {
                        id: 1,
                        title: 'スライド作成',
                        interest: 3,
                        pleasant: 2,
                        complexity: 2,
                        importance: 4
                    }
                ],
                microtasks: []
            },
            methods: {
                receiveMessage: function(message){
                    this.message = message;
                    this.subtodos.push({
                        id: this.subid,
                        title: this.message
                    })
                },
                addTodo: function(){
                    if (this.newTodo.trim().length == 0) {
                        return
                    }
                    this.todos.push({
                        id: this.idForTodo,
                        title: this.newTodo,
                        interest: this.interest,
                        pleasant: this.pleasant,
                        complexity: this.complexity,
                        importance: this.importance
                    })
                    //フォームを空にする
                    this.newTodo = ''
                    this.idForTodo++
                    },
                createMicrotasks: function() {
                    if(this.complexity > 2){
                        return true
                    }else{
                        this.idForTodo++
                        return false
                    }
                    },
                removeTodo: function(index) {
                    this.todos.splice(index, 1)
                    },
                getIndex: function(index){
                    console.log(index + 1)
                    this.subid = index + 1
                }
            },
            computed: {
                showMicrotasks: function(){
                    return this.subtodos.filter(item => item.id == this.subid)
                }
            }
        })
    </script>
    <style>
        .todo-input {
            margin-top: 5%;
            padding: 0% 15%
        }

        .label {
            font-size: small;
        }

        .level {
            font-size: large;
            font-weight: 700;
        }

        .submit-button {
            margin-top: 2%;
        }
    </style>
</body>
</html>